<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MicroFormix | OCR & Scan2PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#4facfe,#8f6cf1);
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  background:#fff;
  width:95%;
  max-width:520px;
  padding:25px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  text-align:center;
}

.logo{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
}

.logo-icon{
  width:45px;
  height:45px;
  border-radius:12px;
  background:#4facfe;
  color:white;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
}

.menu{
  margin:20px 0;
  display:flex;
  justify-content:center;
  gap:10px;
}

.menu button{
  padding:10px 16px;
  border:none;
  border-radius:20px;
  font-weight:bold;
  cursor:pointer;
  background:#eee;
}

.menu button.active{
  background:#4facfe;
  color:white;
}

input, textarea{
  width:100%;
  margin-top:10px;
}

textarea{
  height:180px;
}

.action{
  margin-top:15px;
  padding:10px 20px;
  background:#4facfe;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

#status{
  font-size:14px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="container">

  <!-- LOGO -->
  <div class="logo">
    <div class="logo-icon">MF</div>
    <h2>MicroFormix</h2>
  </div>
  <p>Simple Tools. Smart Work.</p>

  <!-- MENU -->
  <div class="menu">
    <button id="btnOCR" class="active" onclick="showOCR()">OCR</button>
    <button id="btnPDF" onclick="showPDF()">Scan2PDF</button>
  </div>

  <!-- OCR SECTION -->
  <div id="ocr">
    <input type="file" id="ocrImage" accept="image/*">
    <button class="action" onclick="runOCR()">Extract Text (English + Tamil)</button>
    <p id="status"></p>
    <textarea id="ocrOutput" readonly placeholder="OCR text will appear here..."></textarea>
    <button class="action" onclick="textToPDF()">Download Text as PDF</button>
  </div>

  <!-- SCAN2PDF SECTION -->
  <div id="pdf" style="display:none;">
    <input type="file" id="pdfImages" accept="image/*" multiple>
    <button class="action" onclick="imageToPDF()">Convert Images to PDF</button>
  </div>

</div>

<script>
function showOCR(){
  document.getElementById("ocr").style.display="block";
  document.getElementById("pdf").style.display="none";
  setActive("btnOCR");
}

function showPDF(){
  document.getElementById("ocr").style.display="none";
  document.getElementById("pdf").style.display="block";
  setActive("btnPDF");
}

function setActive(id){
  btnOCR.classList.remove("active");
  btnPDF.classList.remove("active");
  document.getElementById(id).classList.add("active");
}

// OCR (Tamil + English)
function runOCR(){
  const img = document.getElementById("ocrImage").files[0];
  const status = document.getElementById("status");
  const out = document.getElementById("ocrOutput");

  if(!img){ alert("Select image"); return; }

  status.innerText="Reading Tamil + English...";
  out.value="";

  Tesseract.recognize(
    img,
    "tam+eng",
    { logger:m=>{ if(m.progress) status.innerText="Progress: "+Math.floor(m.progress*100)+"%"; } }
  ).then(r=>{
    out.value=r.data.text;
    status.innerText="OCR Completed ✅";
  }).catch(()=>{
    status.innerText="OCR Failed ❌";
  });
}

// OCR TEXT → PDF
function textToPDF(){
  const {jsPDF}=window.jspdf;
  const text=document.getElementById("ocrOutput").value;
  if(!text.trim()){ alert("No text"); return; }
  const pdf=new jsPDF();
  pdf.text(text,10,10,{maxWidth:190});
  pdf.save("microformix_ocr.pdf");
}

// IMAGE → PDF
async function imageToPDF(){
  const files=document.getElementById("pdfImages").files;
  if(files.length===0){ alert("Select images"); return; }
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();

  for(let i=0;i<files.length;i++){
    const img=await readImg(files[i]);
    if(i>0) pdf.addPage();
    pdf.addImage(img,"JPEG",10,10,190,270);
  }
  pdf.save("microformix_scan2pdf.pdf");
}

function readImg(f){
  return new Promise(r=>{
    const fr=new FileReader();
    fr.onload=()=>r(fr.result);
    fr.readAsDataURL(f);
  });
}
</script>

</body>
</html>

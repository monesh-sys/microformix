<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MicroFormix | OCR & Scan2PDF</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tesseract OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#4facfe,#8f6cf1);
  display:flex;
  justify-content:center;
  align-items:center;
}

.container{
  background:#fff;
  width:95%;
  max-width:540px;
  padding:25px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  text-align:center;
}

.logo{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
}

.logo-icon{
  width:46px;
  height:46px;
  border-radius:12px;
  background:#4facfe;
  color:white;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
}

.menu{
  margin:20px 0;
  display:flex;
  justify-content:center;
  gap:10px;
}

.menu button{
  padding:10px 16px;
  border:none;
  border-radius:20px;
  font-weight:bold;
  cursor:pointer;
  background:#eee;
}

.menu button.active{
  background:#4facfe;
  color:white;
}

input, textarea, select{
  width:100%;
  margin-top:10px;
}

textarea{
  height:180px;
}

.action{
  margin-top:15px;
  padding:10px 20px;
  background:#4facfe;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.note{
  font-size:12px;
  color:#777;
  margin-top:6px;
}

#status{
  font-size:14px;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="container">

  <!-- LOGO -->
  <div class="logo">
    <div class="logo-icon">MF</div>
    <h2>MicroFormix</h2>
  </div>
  <p>Simple Tools. Smart Work.</p>

  <!-- MENU -->
  <div class="menu">
    <button id="btnOCR" class="active" onclick="showOCR()">OCR</button>
    <button id="btnPDF" onclick="showPDF()">Scan2PDF</button>
  </div>

  <!-- OCR -->
  <div id="ocr">
    <input type="file" id="ocrImage" accept="image/*">

    <select id="lang">
      <option value="eng">English</option>
      <option value="tam">Tamil (Beta)</option>
      <option value="tam+eng">Tamil + English (Beta)</option>
    </select>

    <button class="action" onclick="runOCR()">Extract Text</button>

    <p id="status"></p>

    <textarea id="ocrOutput" readonly placeholder="OCR text will appear here..."></textarea>

    <button class="action" onclick="textToPDF()">Download Text as PDF</button>

    <div class="note">
      Tamil OCR works best with **printed clear text**.  
      Handwritten Tamil is not supported.
    </div>
  </div>

  <!-- SCAN2PDF -->
  <div id="pdf" style="display:none;">
    <input type="file" id="pdfImages" accept="image/*" multiple>
    <button class="action" onclick="imageToPDF()">Convert Images to PDF</button>
  </div>

</div>

<script>
function showOCR(){
  ocr.style.display="block";
  pdf.style.display="none";
  btnOCR.classList.add("active");
  btnPDF.classList.remove("active");
}

function showPDF(){
  ocr.style.display="none";
  pdf.style.display="block";
  btnPDF.classList.add("active");
  btnOCR.classList.remove("active");
}

/* BEST POSSIBLE BROWSER OCR (Tamil + English) */
function runOCR(){
  const img = document.getElementById("ocrImage").files[0];
  const lang = document.getElementById("lang").value;
  const status = document.getElementById("status");
  const out = document.getElementById("ocrOutput");

  if(!img){
    alert("Please select a clear image");
    return;
  }

  status.innerText = "OCR running… first time may take longer";
  out.value = "";

  Tesseract.recognize(
    img,
    lang,
    {
      tessedit_pageseg_mode: 1,
      logger: m => {
        if(m.progress){
          status.innerText = "Progress: " + Math.floor(m.progress * 100) + "%";
        }
      }
    }
  ).then(r=>{
    out.value = r.data.text;
    status.innerText = "OCR completed ✅";
  }).catch(e=>{
    console.error(e);
    status.innerText = "OCR failed ❌";
  });
}

/* TEXT → PDF */
function textToPDF(){
  const {jsPDF} = window.jspdf;
  const text = document.getElementById("ocrOutput").value;
  if(!text.trim()){
    alert("No text to convert");
    return;
  }
  const pdf = new jsPDF();
  pdf.text(text,10,10,{maxWidth:190});
  pdf.save("microformix_ocr.pdf");
}

/* IMAGE → PDF */
async function imageToPDF(){
  const files = document.getElementById("pdfImages").files;
  if(files.length===0){
    alert("Select images");
    return;
  }
  const {jsPDF} = window.jspdf;
  const pdf = new jsPDF();

  for(let i=0;i<files.length;i++){
    const img = await readImg(files[i]);
    if(i>0) pdf.addPage();
    pdf.addImage(img,"JPEG",10,10,190,270);
  }
  pdf.save("microformix_scan2pdf.pdf");
}

function readImg(f){
  return new Promise(r=>{
    const fr = new FileReader();
    fr.onload = ()=>r(fr.result);
    fr.readAsDataURL(f);
  });
}
</script>

</body>
</html>
